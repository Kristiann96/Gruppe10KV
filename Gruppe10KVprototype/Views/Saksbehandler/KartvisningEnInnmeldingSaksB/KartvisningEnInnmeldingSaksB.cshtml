@model ViewModels.KartvisningEnInnmeldingSaksBViewModel
<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innmelding Detaljer</title>
    <!-- Leaflet stilark -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
</head>
<body>
    <div class="container">
        <!-- Informasjonspanel -->
        <div class="info-panel">
            @if (Model?.InnmeldingDetaljer != null)
            {
                <h2>@Model.InnmeldingDetaljer.Tittel</h2>

                <div class="status-info">
                    <label for="statusDropdown">Status:</label>
                    <select id="statusDropdown" class="form-control" asp-for="InnmeldingDetaljer.Status" asp-items="Model.StatusOptions">
                        <option value="">Velg status</option>
                    </select>
                    <p>Prioritet: <span class="badge">@Model.InnmeldingDetaljer.Prioritet</span></p>
                    <p>Sist endret: @Model.InnmeldingDetaljer.SisteEndring.ToString("dd.MM.yyyy HH:mm")</p>
                    <p>KartType: <span class="badge">@Model.InnmeldingDetaljer.KartType</span></p>
                </div>

                <div class="description">
                    <h3>Beskrivelse</h3>
                    <p>@Model.InnmeldingDetaljer.Beskrivelse</p>
                </div>

                <div class="reporter-info">
                    <h3>Innmelder</h3>
                    @if (Model.InnmeldingDetaljer.InnmelderId.HasValue &&
                   !string.IsNullOrEmpty(Model.InnmeldingDetaljer.InnmelderType))
                    {
                        <p>Type: @Model.InnmeldingDetaljer.InnmelderType</p>
                        @if (!string.IsNullOrEmpty(Model.InnmeldingDetaljer.Fornavn) &&
                       !string.IsNullOrEmpty(Model.InnmeldingDetaljer.Etternavn))
                        {
                            <p>Navn: @Model.InnmeldingDetaljer.Fornavn @Model.InnmeldingDetaljer.Etternavn</p>
                        }
                    }
                    else if (Model.InnmeldingDetaljer.GjestInnmelderId.HasValue)
                    {
                        <p>Gjesteinnmelder</p>
                    }
                    else
                    {
                        <p>Ingen innmelder informasjon tilgjengelig</p>
                    }
                </div>

                @if (Model.InnmeldingDetaljer.SaksbehandlerId.HasValue &&
               !string.IsNullOrEmpty(Model.InnmeldingDetaljer.SaksbehandlerStilling))
                {
                    <div class="handler-info">
                        <h3>Saksbehandler</h3>
                        <p>Stilling: @Model.InnmeldingDetaljer.SaksbehandlerStilling</p>
                    </div>
                }
            }
            else
            {
                <p>Ingen innmeldingsdetaljer tilgjengelig</p>
            }
        </div>
        <!-- Kart -->
        <div id="map" style="height: 500px;"></div>
    </div>

    <!-- JavaScript biblioteker -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <!-- Våre konfigurasjonsfiler -->
    <script src="~/js/maps/config/mapConfig.js"></script>
    <script src="~/js/maps/utils/mapControls.js"></script>

    <script>
        // Initialiser kartet
        const map = MapConfig.initializeMap('map');
        // Legg til søkefunksjonalitet
        MapControls.initializeSearch(map);

        @if (Model?.GeometriData != null && !string.IsNullOrEmpty(Model.GeometriData.GeometriGeoJson))
        {
            <text>
                        // Vis geometri for denne innmeldingen
                    const geoJsonFeature = JSON.parse('@Html.Raw(Model.GeometriData.GeometriGeoJson)');
                    const geoJsonLayer = L.geoJSON(geoJsonFeature).addTo(map);
                    // Zoom til innmeldingen
                    map.fitBounds(geoJsonLayer.getBounds());
            </text>
        }
    </script>

    <style>
        .container {
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .info-panel {
            flex: 1;
            max-width: 400px;
        }

        #map {
            flex: 2;
        }

        .badge {
            padding: 5px 10px;
            border-radius: 4px;
            background-color: #f0f0f0;
        }
    </style>
</body>
</html>