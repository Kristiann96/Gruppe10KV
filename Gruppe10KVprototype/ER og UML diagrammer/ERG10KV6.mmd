erDiagram

    person {
        int PersonID PK "AUTO_INCREMENT"
        VARCHAR(50) navn "NOT NULL"
        VARCHAR(50) etternavn "NOT NULL"
        VARCHAR(15) telefonnummer "UNIQUE, NOT NULL"
    }
    person ||--|O innmelder : "er"
    person ||--|O saksbehandler : "er"
    innmelder ||--o{ innmelding : "lager"
    gjesteinnmelder ||--|{ innmelding : "lager"
    gjesteinnmelder {
        int gjest_innmelder_id PK "AUTO_INCREMENT"
        int innmelding_id FK "NOT NULL"
        VARCHAR(100) epost "UNIQUE, NOT NULL"
    }

    innmelder {
        int person_id PK, FK "NOT NULL"
        VARCHAR(100) epost "UNIQUE, NOT NULL"
        ENUMUMERATION innmelder_type "NOT NULL"
    }

    saksbehandler ||--o{ innmelding : "behandler"
    saksbehandler {
        int person_id PK, FK "NOT NULL"
        VARCHAR(100) jobbepost "UNIQUE, NOT NULL"
        VARCHAR(15) jobbtelefon "UNIQUE, NOT NULL"
        ENUMUMERATION stilling "NOT NULL"
    }
    innmelding ||--|{ geometri : "har"
    innmelding ||--o{ tilbakemelding : "mottar"    
    innmelding {
        int innmelding_id PK "AUTO_INCREMENT"
        int innmelder_id FK "NULL"
        int saksbehandler_id FK "NULL"
        VARCHAR(100) tittel "NOT NULL"
        VARCHAR(MAX) beskrivelse "NOT NULL"
        datetime innmeldingstidspunkt "NOT NULL, DEFAULT CURRENT_TIMESTAMP"
        ENUMERATION status "NOT NULL"
        datetime siste_endring "NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP"
        ENUMERATION prioritet "NOT NULL"
        ENUMERATION kart_type "NOT NULL"
    }    
    geometri {
        int geometri_id PK "AUTO_INCREMENT"
        int innmelding_id FK "NOT NULL"
        longtext geometri_data "NOT NULL"
        
    }
    tilbakemelding {
        int tilbakemeldings_id PK "AUTO_INCREMENT"
        int innmelding_id FK "NOT NULL"
        int saksbehandler_id FK "NOT NULL"
        datetime dato "NOT NULL, DEFAULT CURRENT_TIMESTAMP"
        VARCHAR(MAX) innhold "NOT NULL"
    }
    saksbehandler ||--o{ tilbakemelding : "skriver"